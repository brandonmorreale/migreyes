// Generated by CoffeeScript 1.6.3
var $currentPhoto, closeProject, escapable, filterEssays, getHeight, longestFirst, newestFirst, nextPhoto, oldestFirst, parallax, previousPhoto, responsivePSA, responsiveTest, setHeight, setupGallery, shortestFirst, showWidth, swapBio, toggleBio;

swapBio = function(bio) {
  var $bio;
  $bio = $('section.biography');
  return $bio.find('article:not(bio)').fadeOut(function() {
    return $bio.find(bio).fadeIn();
  });
};

toggleBio = function(bio) {
  var position;
  position = document.body.scrollTop;
  if (position > 200) {
    return $('body').animate({
      scrollTop: 0
    }, {
      duration: 500,
      complete: function() {
        return swapBio(bio);
      }
    });
  } else {
    return swapBio(bio);
  }
};

$(function() {
  var $portraitOverlay, $portraitToggle;
  $portraitToggle = $('.portrait-toggle');
  $portraitOverlay = $('.portrait');
  $portraitToggle.find('img').on('click', function() {
    return $portraitOverlay.fadeIn();
  });
  $portraitOverlay.on('click', function() {
    if ($(window).width() >= 768) {
      return $(this).fadeOut();
    }
  });
  $('[data-toggle~="bio"]').on('click', function() {
    return toggleBio($(this).data('bio'));
  });
  return parallax($portraitToggle, 'top', -40, 250, -1.5);
});

$currentPhoto = 1;

showWidth = function() {
  return document.title = "Mig Reyes " + $(window).width();
};

setupGallery = function() {
  var $gallery, $height, $photoPosition, $photos;
  $gallery = $('.gallery');
  $photos = $gallery.find('figure');
  $height = getHeight();
  $photoPosition = 0;
  setHeight($gallery, $height);
  setHeight($photos, $height);
  return $photos.each(function() {
    $(this).css({
      left: $photoPosition,
      width: $(window).width()
    });
    return $photoPosition += $(window).width();
  });
};

getHeight = function() {
  return Math.floor($(window).width() * 0.535);
};

setHeight = function(el, height) {
  var $el;
  $el = $(el);
  return $el.height(height);
};

nextPhoto = function() {
  var $gallery, distance;
  $gallery = $('.photos');
  distance = $(window).width() * $currentPhoto;
  $currentPhoto += 1;
  if ($currentPhoto > $gallery.find('figure').length) {
    $gallery.animate({
      left: "0"
    }, 500);
    return $currentPhoto = 1;
  } else {
    return $gallery.animate({
      left: -distance
    }, 500);
  }
};

previousPhoto = function() {
  var $gallery, $lastPhoto, distance;
  $gallery = $('.photos');
  $lastPhoto = $gallery.find('figure').length;
  $currentPhoto -= 1;
  if ($currentPhoto < 1) {
    distance = $(window).width() * ($lastPhoto - 1);
    $gallery.animate({
      left: -distance
    }, 500);
    return $currentPhoto = $lastPhoto;
  } else {
    distance = $(window).width() * ($currentPhoto - 1);
    return $gallery.animate({
      left: -distance
    }, 500);
  }
};

$(function() {
  var $bike;
  setupGallery();
  $(window).resize(function() {
    return setupGallery();
  });
  if ($(window).width() >= 768) {
    $('.photos figure').on("click", function() {
      return nextPhoto();
    });
  }
  $('[data-photo~="next"]').on("click", function() {
    return nextPhoto();
  });
  $('[data-photo~="previous"]').on("click", function() {
    return previousPhoto();
  });
  $bike = $('.hero figure');
  $(window).on("scroll", function() {
    return $bike.css('top', $(window).scrollTop() * .5);
  });
  return $(window).bind("keydown", function(event) {
    switch (event.keyCode) {
      case 37:
        return previousPhoto();
      case 39:
        return nextPhoto();
    }
  });
});

closeProject = function() {
  document.title = "The work & play of Mig Reyes";
  $('[data-project-header]').text('Work and play');
  window.history.pushState('', '', '/makes');
  $('[data-project]').show();
  $('div.project-details').hide();
  return $('[data-behavior="close"]').hide();
};

$(function() {
  var $closeButton, $headline;
  $headline = $('[data-project-header]');
  $closeButton = $('[data-behavior="close"]');
  $('[data-project]').click(function() {
    var $details, $project, $projectName, $url;
    $projectName = $(this).find('h1').text();
    $headline.text($projectName);
    $(this).siblings().hide();
    $details = $(this).find('.project-details');
    if ($details.length) {
      $details.show();
    } else {
      $url = $(this).find('a').attr('href');
      $project = $('<div class="project-details">').load($url + ' .details');
      $(this).append($project);
    }
    document.title = $projectName + ' by Mig Reyes';
    window.history.pushState('', '', $url);
    $closeButton.show();
    return false;
  });
  return $closeButton.click(function() {
    return closeProject();
  });
});

parallax = function(element, direction, start, stop, rate) {
  return $(window).on('scroll', function() {
    var position;
    position = document.body.scrollTop;
    if (position >= start && position <= stop) {
      return element.css(direction, $(window).scrollTop() * rate);
    }
  });
};

responsiveTest = function() {
  return $(window).resize(function() {
    return document.title = $(window).width();
  });
};

responsivePSA = function() {
  var $message, resizeTimer;
  $message = $('aside.public-service-announcement');
  resizeTimer = void 0;
  return $(window).resize(function() {
    if (!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
      $message.fadeIn();
      if (resizeTimer) {
        clearTimeout(resizeTimer);
      }
      return resizeTimer = setTimeout(function() {
        resizeTimer = null;
        return $message.fadeOut();
      }, 1200);
    }
  });
};

escapable = function() {
  return $('[data-behavior~="escapable"]').fadeOut();
};

$(function() {
  return $(window).bind('keydown', function(event) {
    switch (event.keyCode) {
      case 27:
        escapable();
        return closeProject();
    }
  });
});

filterEssays = function(essayType) {
  var $essayList, $essays, $favoriteToggle, $nonfavorites;
  $essays = $('section.essays ul');
  $essayList = $essays.find('li');
  $nonfavorites = $essays.find('li:not([data-favorite])');
  $favoriteToggle = $('[data-essay-filter~="favorites"]');
  switch (essayType) {
    case 'favorites':
      if ($favoriteToggle.hasClass('selected')) {
        $nonfavorites.show();
      } else {
        $nonfavorites.hide();
      }
      return $favoriteToggle.toggleClass('selected');
    case 'recent':
      return $essayList.sort(newestFirst).appendTo($essays);
    case 'shortest':
      return $essayList.sort(shortestFirst).appendTo($essays);
  }
};

shortestFirst = function(a, b) {
  if (($(b).data('words')) < ($(a).data('words'))) {
    return 1;
  } else {
    return -1;
  }
};

longestFirst = function(a, b) {
  if (($(b).data('words')) > ($(a).data('words'))) {
    return 1;
  } else {
    return -1;
  }
};

newestFirst = function(a, b) {
  if (($(b).data('date')) < ($(a).data('date'))) {
    return 1;
  } else {
    return -1;
  }
};

oldestFirst = function(a, b) {
  if (($(b).data('date')) > ($(a).data('date'))) {
    return 1;
  } else {
    return -1;
  }
};

$(function() {
  var $delay, $essayList, $essays, $thoughtList;
  $essays = $('section.essays ul');
  $essayList = $essays.find('li');
  $essayList.each(function() {
    var $readingTime, $words;
    $words = $(this).data('words');
    $readingTime = Math.floor($words / 3);
    if ($readingTime < 60) {
      return $(this).find('[data-reading-time]').text($readingTime + ' second read');
    } else {
      $readingTime = Math.floor($readingTime / 60);
      return $(this).find('[data-reading-time]').text($readingTime + ' minute read');
    }
  });
  $delay = 0;
  $essayList.each(function() {
    $delay += 50;
    $(this).css({
      opacity: 0
    });
    return $(this).delay($delay).fadeTo(500, 1);
  });
  $('[data-essay-filter]').click(function() {
    filterEssays($(this).data('essay-filter'));
    if ($(this).find('span').hasClass('radio')) {
      $(this).addClass('selected');
      return $(this).siblings().removeClass('selected');
    }
  });
  $thoughtList = $('[data-thought]');
  return $thoughtList.each(function() {
    $delay += 50;
    $(this).css({
      opacity: 0
    });
    return $(this).delay($delay).fadeTo(500, 1);
  });
});
